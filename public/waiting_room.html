<!DOCTYPE html>
<html>
  <head>
    <title>Join Room</title>
  </head>

  <script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Parse URL for the user string
    var url_string = window.location.href;
    var url = new URL(url_string);
    var username = url.searchParams.get("username");
    var channelID = url.searchParams.get("room"); 

    // Create channel server side
    var socket = io();

    // // send a join message to the overall channel
    // socket.emit('joinChannel', { channelID : code , userID : username});


    // // this is the workhorse of the gameplay
    // // params: data {method, payload}
    // socket.on(code, function(data) {
    //   // when the room owner initiates 'start'
    //   // do a get request to get the card.html pages
    // console.log("Got HIT" + data);
    // if (data.method == 'start') {
    
    //   window.location = /game/+code+'?username='+userID
    
    // } else if (data.method == 'new_player') {
    //   // update the new player div element
    // }

    // })

    socket.emit('mailman', '{"method" : "join_channel", "payload" : {"username" : "' + username + '", "channelID" : "'+channelID+'"}}')

    socket.on("messages", function (data) {
      var data = JSON.parse(data)
      console.log(data)
      if (data.method == 'start') {
        console.log('STARTING THE GAME!!!')
        window.location = /game/+channelID+'?username='+username
      } else if (data.method == 'new_player') {
        document.getElementById('newplayers').innerHTML += data.payload.username
      }
    })



    // Update number of players in room on a
    // socket.on(channelID, function(data)) {
      
    // }
  </script>

  <body>
    <h1>
      Joined <h1 id="roomHostId"></h1>'s room!

      There are currently <h1 id="numPeople"> X </h1> players in the room right now! 
      <div id="newplayers"> </div>
      Waiting for 5 to start the game.
    </h1>

  </body>
</html>